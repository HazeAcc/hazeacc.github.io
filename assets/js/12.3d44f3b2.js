(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{215:function(v,_,t){"use strict";t.r(_);var a=t(1),s=Object(a.a)({},function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"从-tofixed-看“四舍五入法”的正确性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从-tofixed-看“四舍五入法”的正确性","aria-hidden":"true"}},[v._v("#")]),v._v(" 从 toFixed() 看“四舍五入法”的正确性")]),v._v(" "),t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[v._v("#")]),v._v(" 前言")]),v._v(" "),t("p",[v._v("“四舍五入”这条规则是每个人从小学就学到的一条小数舍入规则，无非是看舍去位是小于等于4还是大于等于5。")]),v._v(" "),t("p",[v._v("小时候的我觉得它好像是公平的。")]),v._v(" "),t("p",[v._v("“0、1、2、3、4”一组，“5、6、7、8、9”一组，每组五个，谁也不欠谁。")]),v._v(" "),t("p",[v._v("但是，我的心里又总觉得哪里有些不对，苦于说不出来最后只好作罢。")]),v._v(" "),t("p",[v._v("但长大后，当我使用到 JavaScript 的 "),t("code",[v._v("toFixed()")]),v._v(" 函数时，却惊讶地发现：它并不是一直都会四舍五入的。")]),v._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[v._v("1.35")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[v._v("toFixed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[v._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),v._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 1.4")]),v._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[v._v("1.45")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[v._v("toFixed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[v._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),v._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 1.4")]),v._v("\n")])])]),t("p",[v._v("为什么对于相同的尾数5的舍入，结果却不同呢？")]),v._v(" "),t("p",[v._v("我简单查阅了一下资料，有些人这么解释道："),t("code",[v._v("toFixed()")]),v._v(" 使用的是“银行家舍入法”。")]),v._v(" "),t("br"),v._v(" "),t("h2",{attrs:{id:"银行家舍入法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#银行家舍入法","aria-hidden":"true"}},[v._v("#")]),v._v(" 银行家舍入法")]),v._v(" "),t("p",[v._v("什么是“银行家舍入法”呢？")]),v._v(" "),t("p",[v._v("银行家舍入法是由 IEEE 754 标准规定的浮点数取整算法，大部分的编程软件都使用这种方法。")]),v._v(" "),t("p",[v._v("该方法又被称为“四舍六入五取偶法”或者“四舍六入五留双法”。其规则是：")]),v._v(" "),t("p",[v._v("当舍去位的数值：")]),v._v(" "),t("ul",[t("li",[v._v("小于等于4，直接舍去该位")]),v._v(" "),t("li",[v._v("大于等于6，向前位进一")]),v._v(" "),t("li",[v._v("等于5\n"),t("ul",[t("li",[v._v("5后有数，向前位进一")]),v._v(" "),t("li",[v._v("5后全0\n"),t("ul",[t("li",[v._v("5前位数值为奇，则向前位进一（将前位凑成偶）")]),v._v(" "),t("li",[v._v("5前位数值为偶，则直接舍去该位")])])])])])]),v._v(" "),t("p",[v._v("为什么会有这样的规则呢？如果银行家舍入法是对的，那我们一直以来十分信任的四舍五入岂不就错了？")]),v._v(" "),t("p",[v._v("我们先了解一下，为什么叫做银行家舍入法：")]),v._v(" "),t("p",[v._v("假如我们使用四舍五入法，且假设银行收到的钱中，要舍入的那位数在0~9是等概率的，那么假设银行分别收到了"),t("code",[v._v("0.0, 0.1, ..., 0.9")]),v._v("元，然后通过四舍五入法，银行能够得到五个"),t("code",[v._v("0.0")]),v._v("和五个"),t("code",[v._v("1.0")]),v._v("。")]),v._v(" "),t("p",[v._v("但是实际上，银行收到的总共的钱"),t("code",[v._v("0.0 + 0.1 + ... + 0.9 = 4.5")]),v._v("元，而银行日后却得为客户付还"),t("code",[v._v("1.0 * 5 = 5.0")]),v._v("元，这样银行就亏了"),t("code",[v._v("0.5")]),v._v("元钱了。")]),v._v(" "),t("p",[v._v("啊这到底是怎么回事，为什么看起来公平的事情，结果又变得并不公平？")]),v._v(" "),t("p",[v._v("有人可能发现了：在“舍去阵营”中，"),t("code",[v._v("0.0")]),v._v("其实并没有任何的损失，而“进位阵营”则或多或少都有好好地赚一笔。")]),v._v(" "),t("p",[v._v("那这样的话，我们不如从1到9中取中位数，那就是5了，小于5的舍弃、大于5的进位...")]),v._v(" "),t("p",[v._v("等会，那5该怎么办？")]),v._v(" "),t("p",[v._v("于是银行家们又想到，可以考虑要舍入的位置的前一位的数是奇是偶的情况是等概率的。")]),v._v(" "),t("p",[v._v("那么我们可以规定：")]),v._v(" "),t("ul",[t("li",[v._v("舍去位为5，且其前位数值为奇，则向前位进一")]),v._v(" "),t("li",[v._v("舍去位为5，且其前位数值为偶，则直接舍去该位")])]),v._v(" "),t("p",[v._v("那么，这样就完美了么？")]),v._v(" "),t("p",[v._v("其实不然。")]),v._v(" "),t("blockquote",[t("p",[v._v("网上关于“为什么5作为舍入位，5后全零时才分奇偶舍入”有许多解释，但笔者并没能完全赞同它们的道理，于是我从另外一个角度进行解释：")])]),v._v(" "),t("p",[v._v("从0到1的小数们进位为整数，从四舍五入法的角度，"),t("code",[v._v("0.5")]),v._v("与"),t("code",[v._v("0.51")]),v._v("想要变成整数从地位上都是一样的，只看小数点后的"),t("code",[v._v("5")]),v._v("，于是0到1的小数们就变成了离散的"),t("code",[v._v("0.0, 0.1, ..., 0.9, 1.0")]),v._v("。")]),v._v(" "),t("blockquote",[t("p",[v._v("这里出现"),t("code",[v._v("1.0")]),v._v("是因为将连续值约为了离散值，与原本就是离散的情况是不同的。")])]),v._v(" "),t("p",[v._v("而实际上我们可以考虑0到1之间的小数们为连续的"),t("code",[v._v("0.000... ~ 0.999...")]),v._v("（无穷小数）。")]),v._v(" "),t("p",[v._v("当然，不论是离散还是连续，他们的中位数都是0.5整。")]),v._v(" "),t("p",[v._v("区别在于，对于离散的，我们可以"),t("code",[v._v("0.0, 0.1, 0.2, 0.3, 0.4")]),v._v("一组，"),t("code",[v._v("0.6, 0.7, 0.8, 0.9, 1.0")]),v._v("一组，然后"),t("code",[v._v("0.5")]),v._v("看情况对半分。")]),v._v(" "),t("p",[v._v("但是，对于连续的情况，举例"),t("code",[v._v("0.51")]),v._v("、"),t("code",[v._v("0.5001")]),v._v("等数，它们其实被划到了 (0.5, 0.999...) 的区间，是需要进位的，而不应被对半分。")]),v._v(" "),t("p",[v._v("所以就有了银行家舍入法的“要求5后全为0才可以进行奇偶判断”的规则。")]),v._v(" "),t("br"),v._v(" "),t("h2",{attrs:{id:"四舍五入的“正确性”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四舍五入的“正确性”","aria-hidden":"true"}},[v._v("#")]),v._v(" 四舍五入的“正确性”")]),v._v(" "),t("p",[v._v("如果你已经认可了银行家舍入法的正确性，那你不可避免地要对四舍五入法产生了怀疑三连：四舍五入法错了吗？它又错在哪呢？为什么大家都用它？")]),v._v(" "),t("p",[v._v("我们回过来看看“四舍五入法”。")]),v._v(" "),t("p",[v._v("实际上，如果考虑无穷多位小数，那0.5整其实只是 (0.000..., 0.999...) 这个区间一个很小的点，从概率而言是约等于0的，所以在这种情况下，四舍五入确实做到了“五五开”。")]),v._v(" "),t("p",[v._v("但问题就是，我们遇到的小数一般都是有穷小数，如果我们只约去小数的最后一位，那么确实就出现了 "),t("code",[v._v("0.1, 0.2, 0.3, 0.4")]),v._v(" 与 "),t("code",[v._v("0.5, 0.6, 0.7, 0.8, 0.9")]),v._v(" 不对等的情况。")]),v._v(" "),t("p",[v._v("这就造成了在数学上，我们的“四舍五入法”是理论正确的；但在实际生活中（如以上的银行存钱问题），基本上都是有穷小数。无穷小数的“缺少”导致了四舍五入法不再严格正确。")]),v._v(" "),t("p",[v._v("那话就说回来了，为什么我们还在使用四舍五入法呢？")]),v._v(" "),t("p",[v._v("答案其实是很简单的，只有两个字——方便。")]),v._v(" "),t("p",[v._v("另外一个方面，如果我们约去的尾数位数比较多，误差就会变得很小。")]),v._v(" "),t("p",[v._v("比如，如果我们约去的不是一位数而是两位数，那么从"),t("code",[v._v("0.01")]),v._v("到"),t("code",[v._v("0.99")]),v._v("一共有99个数想要被约为整数0或1，比例就变成了"),t("code",[v._v("49:50")]),v._v("，这之中的误差已经非常小了。")]),v._v(" "),t("p",[v._v("所以在约去的小数位数较多时，四舍五入仍然具有很好的使用价值。")]),v._v(" "),t("p",[v._v("而我们如果需要涉及到严格的情况时，则再采用银行家舍入法即可。")]),v._v(" "),t("br"),v._v(" "),t("h2",{attrs:{id:"后记"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后记","aria-hidden":"true"}},[v._v("#")]),v._v(" 后记")]),v._v(" "),t("p",[v._v("说是 "),t("code",[v._v("toFixed()")]),v._v(" 使用的银行家舍入法所以表现起来不是四舍五入，但是在 Chrome 浏览器的实测中，我注意到它也并不一定都符合银行家舍入法：")]),v._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[v._v("0.45")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[v._v("toFixed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[v._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),v._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 0.5 而不是0.4")]),v._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[v._v("1.45")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[v._v("toFixed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[v._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),v._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 1.4")]),v._v("\n")])])]),t("p",[t("img",{attrs:{src:"https://s1.ax1x.com/2020/03/30/Gu3iZD.png",alt:"舍入情况"}})]),v._v(" "),t("p",[v._v("个人认为，这可能是由于浮点数存储精度问题导致的（未查阅资料证实）。")]),v._v(" "),t("p",[v._v("比如这里的"),t("code",[v._v("0.45")]),v._v("其实类似于"),t("code",[v._v("0.4500000002")]),v._v("，存在一点点尾数，所以进行了舍入变为"),t("code",[v._v("0.5")]),v._v("。")]),v._v(" "),t("p",[v._v("有人认为因此在严肃的情况下不应使用 "),t("code",[v._v("toFixed()")]),v._v("，不过我个人倒是认为误差是随机的，所以从概率而言最后得到的结果还是公平的。")]),v._v(" "),t("p",[v._v("不过有一点值得肯定：如果你想要在 JavaScript 中实现四舍五入法保留两位小数，那还是乖乖 "),t("code",[v._v("Math.floor(num * 100) / 100")]),v._v(" 吧~")]),v._v(" "),t("br")])},[],!1,null,null,null);_.default=s.exports}}]);