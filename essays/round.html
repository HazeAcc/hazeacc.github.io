<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从 toFixed() 看“四舍五入法”的正确性 | 山风笔记集</title>
    <meta name="description" content="记录并分享个人所整理的学习知识的笔记与教程">
    <link rel="icon" href="/imgs/favicon.ico">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-158846445-2"></script>
  <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'UA-158846445-2');
        </script>
    
    <link rel="preload" href="/assets/css/0.styles.c0e52d69.css" as="style"><link rel="preload" href="/assets/js/app.8447d795.js" as="script"><link rel="preload" href="/assets/js/2.bd61a9fd.js" as="script"><link rel="preload" href="/assets/js/12.3d44f3b2.js" as="script"><link rel="prefetch" href="/assets/js/10.c23beeee.js"><link rel="prefetch" href="/assets/js/11.a5f8f4b5.js"><link rel="prefetch" href="/assets/js/13.85e66995.js"><link rel="prefetch" href="/assets/js/14.c61deefc.js"><link rel="prefetch" href="/assets/js/15.d567712f.js"><link rel="prefetch" href="/assets/js/16.0bf83400.js"><link rel="prefetch" href="/assets/js/17.39f15163.js"><link rel="prefetch" href="/assets/js/18.e190cbd6.js"><link rel="prefetch" href="/assets/js/19.b00f5399.js"><link rel="prefetch" href="/assets/js/20.24139e2e.js"><link rel="prefetch" href="/assets/js/21.f057fb05.js"><link rel="prefetch" href="/assets/js/22.91c23498.js"><link rel="prefetch" href="/assets/js/23.7e4349d1.js"><link rel="prefetch" href="/assets/js/24.d6b5644e.js"><link rel="prefetch" href="/assets/js/25.652a598d.js"><link rel="prefetch" href="/assets/js/26.239a6015.js"><link rel="prefetch" href="/assets/js/27.264e242d.js"><link rel="prefetch" href="/assets/js/28.b8a526cb.js"><link rel="prefetch" href="/assets/js/29.015f761b.js"><link rel="prefetch" href="/assets/js/3.1fc8e7ad.js"><link rel="prefetch" href="/assets/js/30.0cec9f87.js"><link rel="prefetch" href="/assets/js/31.d44d1dfd.js"><link rel="prefetch" href="/assets/js/32.01db05fd.js"><link rel="prefetch" href="/assets/js/33.b6466c13.js"><link rel="prefetch" href="/assets/js/34.bfcf59c7.js"><link rel="prefetch" href="/assets/js/35.383304c9.js"><link rel="prefetch" href="/assets/js/36.1e6e18c6.js"><link rel="prefetch" href="/assets/js/37.14bf4a83.js"><link rel="prefetch" href="/assets/js/38.5e53f1ea.js"><link rel="prefetch" href="/assets/js/39.5bb4ec98.js"><link rel="prefetch" href="/assets/js/4.7a8bea82.js"><link rel="prefetch" href="/assets/js/40.6c608590.js"><link rel="prefetch" href="/assets/js/41.23bd194f.js"><link rel="prefetch" href="/assets/js/42.d5004363.js"><link rel="prefetch" href="/assets/js/43.0ce9fa33.js"><link rel="prefetch" href="/assets/js/44.3fe716fe.js"><link rel="prefetch" href="/assets/js/45.32c5871d.js"><link rel="prefetch" href="/assets/js/46.b6783264.js"><link rel="prefetch" href="/assets/js/47.f8aab6d2.js"><link rel="prefetch" href="/assets/js/48.1f037f95.js"><link rel="prefetch" href="/assets/js/49.572445ce.js"><link rel="prefetch" href="/assets/js/5.9397a36a.js"><link rel="prefetch" href="/assets/js/50.7180282b.js"><link rel="prefetch" href="/assets/js/51.5e501b8b.js"><link rel="prefetch" href="/assets/js/52.f9837e49.js"><link rel="prefetch" href="/assets/js/53.d3df370a.js"><link rel="prefetch" href="/assets/js/54.6f904856.js"><link rel="prefetch" href="/assets/js/55.fc396f14.js"><link rel="prefetch" href="/assets/js/56.48304ea5.js"><link rel="prefetch" href="/assets/js/57.923bb766.js"><link rel="prefetch" href="/assets/js/58.5987358c.js"><link rel="prefetch" href="/assets/js/59.5c2eeb34.js"><link rel="prefetch" href="/assets/js/6.2f1db989.js"><link rel="prefetch" href="/assets/js/60.4ec959b6.js"><link rel="prefetch" href="/assets/js/61.52d60d03.js"><link rel="prefetch" href="/assets/js/62.f341f0fc.js"><link rel="prefetch" href="/assets/js/63.291774ef.js"><link rel="prefetch" href="/assets/js/64.3da1e937.js"><link rel="prefetch" href="/assets/js/65.44f41773.js"><link rel="prefetch" href="/assets/js/66.aea611c0.js"><link rel="prefetch" href="/assets/js/67.9432b5c4.js"><link rel="prefetch" href="/assets/js/68.f8b420bc.js"><link rel="prefetch" href="/assets/js/69.bd196935.js"><link rel="prefetch" href="/assets/js/7.d3342e12.js"><link rel="prefetch" href="/assets/js/70.5f94436d.js"><link rel="prefetch" href="/assets/js/71.f8d75019.js"><link rel="prefetch" href="/assets/js/72.22a2029f.js"><link rel="prefetch" href="/assets/js/73.b5675a90.js"><link rel="prefetch" href="/assets/js/74.b9910b21.js"><link rel="prefetch" href="/assets/js/75.5aa44913.js"><link rel="prefetch" href="/assets/js/76.db5e59d0.js"><link rel="prefetch" href="/assets/js/77.e4edf460.js"><link rel="prefetch" href="/assets/js/78.adaa1ebd.js"><link rel="prefetch" href="/assets/js/79.c98afd34.js"><link rel="prefetch" href="/assets/js/8.f122493c.js"><link rel="prefetch" href="/assets/js/80.dae99de7.js"><link rel="prefetch" href="/assets/js/81.c8c4cc78.js"><link rel="prefetch" href="/assets/js/82.b8f7657a.js"><link rel="prefetch" href="/assets/js/83.708b497a.js"><link rel="prefetch" href="/assets/js/84.e5cf0bec.js"><link rel="prefetch" href="/assets/js/85.677ae3f9.js"><link rel="prefetch" href="/assets/js/86.b7a99301.js"><link rel="prefetch" href="/assets/js/87.4b8fd909.js"><link rel="prefetch" href="/assets/js/9.095bc7b5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c0e52d69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">山风笔记集</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/" class="nav-link">笔记导航</a></li><li class="dropdown-item"><!----> <a href="/notes/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/notes/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/notes/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/notes/network/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/notes/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/notes/tools/" class="nav-link">工具</a></li></ul></div></div><div class="nav-item"><a href="/pages/recent.html" class="nav-link">最近</a></div><div class="nav-item"><a href="/pages/msg-board.html" class="nav-link">留言</a></div><div class="nav-item"><a href="/pages/about.html" class="nav-link">关于</a></div><div class="nav-item"><a href="https://www.ceynri.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/ceynri" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/" class="nav-link">笔记导航</a></li><li class="dropdown-item"><!----> <a href="/notes/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/notes/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/notes/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/notes/network/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/notes/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/notes/tools/" class="nav-link">工具</a></li></ul></div></div><div class="nav-item"><a href="/pages/recent.html" class="nav-link">最近</a></div><div class="nav-item"><a href="/pages/msg-board.html" class="nav-link">留言</a></div><div class="nav-item"><a href="/pages/about.html" class="nav-link">关于</a></div><div class="nav-item"><a href="https://www.ceynri.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/ceynri" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从-tofixed-看“四舍五入法”的正确性"><a href="#从-tofixed-看“四舍五入法”的正确性" aria-hidden="true" class="header-anchor">#</a> 从 toFixed() 看“四舍五入法”的正确性</h1> <h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p>“四舍五入”这条规则是每个人从小学就学到的一条小数舍入规则，无非是看舍去位是小于等于4还是大于等于5。</p> <p>小时候的我觉得它好像是公平的。</p> <p>“0、1、2、3、4”一组，“5、6、7、8、9”一组，每组五个，谁也不欠谁。</p> <p>但是，我的心里又总觉得哪里有些不对，苦于说不出来最后只好作罢。</p> <p>但长大后，当我使用到 JavaScript 的 <code>toFixed()</code> 函数时，却惊讶地发现：它并不是一直都会四舍五入的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.35</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1.4</span>
<span class="token number">1.45</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1.4</span>
</code></pre></div><p>为什么对于相同的尾数5的舍入，结果却不同呢？</p> <p>我简单查阅了一下资料，有些人这么解释道：<code>toFixed()</code> 使用的是“银行家舍入法”。</p> <br> <h2 id="银行家舍入法"><a href="#银行家舍入法" aria-hidden="true" class="header-anchor">#</a> 银行家舍入法</h2> <p>什么是“银行家舍入法”呢？</p> <p>银行家舍入法是由 IEEE 754 标准规定的浮点数取整算法，大部分的编程软件都使用这种方法。</p> <p>该方法又被称为“四舍六入五取偶法”或者“四舍六入五留双法”。其规则是：</p> <p>当舍去位的数值：</p> <ul><li>小于等于4，直接舍去该位</li> <li>大于等于6，向前位进一</li> <li>等于5
<ul><li>5后有数，向前位进一</li> <li>5后全0
<ul><li>5前位数值为奇，则向前位进一（将前位凑成偶）</li> <li>5前位数值为偶，则直接舍去该位</li></ul></li></ul></li></ul> <p>为什么会有这样的规则呢？如果银行家舍入法是对的，那我们一直以来十分信任的四舍五入岂不就错了？</p> <p>我们先了解一下，为什么叫做银行家舍入法：</p> <p>假如我们使用四舍五入法，且假设银行收到的钱中，要舍入的那位数在0~9是等概率的，那么假设银行分别收到了<code>0.0, 0.1, ..., 0.9</code>元，然后通过四舍五入法，银行能够得到五个<code>0.0</code>和五个<code>1.0</code>。</p> <p>但是实际上，银行收到的总共的钱<code>0.0 + 0.1 + ... + 0.9 = 4.5</code>元，而银行日后却得为客户付还<code>1.0 * 5 = 5.0</code>元，这样银行就亏了<code>0.5</code>元钱了。</p> <p>啊这到底是怎么回事，为什么看起来公平的事情，结果又变得并不公平？</p> <p>有人可能发现了：在“舍去阵营”中，<code>0.0</code>其实并没有任何的损失，而“进位阵营”则或多或少都有好好地赚一笔。</p> <p>那这样的话，我们不如从1到9中取中位数，那就是5了，小于5的舍弃、大于5的进位...</p> <p>等会，那5该怎么办？</p> <p>于是银行家们又想到，可以考虑要舍入的位置的前一位的数是奇是偶的情况是等概率的。</p> <p>那么我们可以规定：</p> <ul><li>舍去位为5，且其前位数值为奇，则向前位进一</li> <li>舍去位为5，且其前位数值为偶，则直接舍去该位</li></ul> <p>那么，这样就完美了么？</p> <p>其实不然。</p> <blockquote><p>网上关于“为什么5作为舍入位，5后全零时才分奇偶舍入”有许多解释，但笔者并没能完全赞同它们的道理，于是我从另外一个角度进行解释：</p></blockquote> <p>从0到1的小数们进位为整数，从四舍五入法的角度，<code>0.5</code>与<code>0.51</code>想要变成整数从地位上都是一样的，只看小数点后的<code>5</code>，于是0到1的小数们就变成了离散的<code>0.0, 0.1, ..., 0.9, 1.0</code>。</p> <blockquote><p>这里出现<code>1.0</code>是因为将连续值约为了离散值，与原本就是离散的情况是不同的。</p></blockquote> <p>而实际上我们可以考虑0到1之间的小数们为连续的<code>0.000... ~ 0.999...</code>（无穷小数）。</p> <p>当然，不论是离散还是连续，他们的中位数都是0.5整。</p> <p>区别在于，对于离散的，我们可以<code>0.0, 0.1, 0.2, 0.3, 0.4</code>一组，<code>0.6, 0.7, 0.8, 0.9, 1.0</code>一组，然后<code>0.5</code>看情况对半分。</p> <p>但是，对于连续的情况，举例<code>0.51</code>、<code>0.5001</code>等数，它们其实被划到了 (0.5, 0.999...) 的区间，是需要进位的，而不应被对半分。</p> <p>所以就有了银行家舍入法的“要求5后全为0才可以进行奇偶判断”的规则。</p> <br> <h2 id="四舍五入的“正确性”"><a href="#四舍五入的“正确性”" aria-hidden="true" class="header-anchor">#</a> 四舍五入的“正确性”</h2> <p>如果你已经认可了银行家舍入法的正确性，那你不可避免地要对四舍五入法产生了怀疑三连：四舍五入法错了吗？它又错在哪呢？为什么大家都用它？</p> <p>我们回过来看看“四舍五入法”。</p> <p>实际上，如果考虑无穷多位小数，那0.5整其实只是 (0.000..., 0.999...) 这个区间一个很小的点，从概率而言是约等于0的，所以在这种情况下，四舍五入确实做到了“五五开”。</p> <p>但问题就是，我们遇到的小数一般都是有穷小数，如果我们只约去小数的最后一位，那么确实就出现了 <code>0.1, 0.2, 0.3, 0.4</code> 与 <code>0.5, 0.6, 0.7, 0.8, 0.9</code> 不对等的情况。</p> <p>这就造成了在数学上，我们的“四舍五入法”是理论正确的；但在实际生活中（如以上的银行存钱问题），基本上都是有穷小数。无穷小数的“缺少”导致了四舍五入法不再严格正确。</p> <p>那话就说回来了，为什么我们还在使用四舍五入法呢？</p> <p>答案其实是很简单的，只有两个字——方便。</p> <p>另外一个方面，如果我们约去的尾数位数比较多，误差就会变得很小。</p> <p>比如，如果我们约去的不是一位数而是两位数，那么从<code>0.01</code>到<code>0.99</code>一共有99个数想要被约为整数0或1，比例就变成了<code>49:50</code>，这之中的误差已经非常小了。</p> <p>所以在约去的小数位数较多时，四舍五入仍然具有很好的使用价值。</p> <p>而我们如果需要涉及到严格的情况时，则再采用银行家舍入法即可。</p> <br> <h2 id="后记"><a href="#后记" aria-hidden="true" class="header-anchor">#</a> 后记</h2> <p>说是 <code>toFixed()</code> 使用的银行家舍入法所以表现起来不是四舍五入，但是在 Chrome 浏览器的实测中，我注意到它也并不一定都符合银行家舍入法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">0.45</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 0.5 而不是0.4</span>
<span class="token number">1.45</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1.4</span>
</code></pre></div><p><img src="https://s1.ax1x.com/2020/03/30/Gu3iZD.png" alt="舍入情况"></p> <p>个人认为，这可能是由于浮点数存储精度问题导致的（未查阅资料证实）。</p> <p>比如这里的<code>0.45</code>其实类似于<code>0.4500000002</code>，存在一点点尾数，所以进行了舍入变为<code>0.5</code>。</p> <p>有人认为因此在严肃的情况下不应使用 <code>toFixed()</code>，不过我个人倒是认为误差是随机的，所以从概率而言最后得到的结果还是公平的。</p> <p>不过有一点值得肯定：如果你想要在 JavaScript 中实现四舍五入法保留两位小数，那还是乖乖 <code>Math.floor(num * 100) / 100</code> 吧~</p> <br></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2020-3-31 9:06:55 ├F10: PM┤</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8447d795.js" defer></script><script src="/assets/js/2.bd61a9fd.js" defer></script><script src="/assets/js/12.3d44f3b2.js" defer></script>
  </body>
</html>
