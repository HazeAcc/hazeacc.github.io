<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器缓存 | 山风笔记集</title>
    <meta name="description" content="记录并分享个人所整理的学习知识的笔记与教程">
    <link rel="icon" href="/imgs/favicon.ico">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-158846445-2"></script>
  <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'UA-158846445-2');
        </script>
    
    <link rel="preload" href="/assets/css/0.styles.c0e52d69.css" as="style"><link rel="preload" href="/assets/js/app.8447d795.js" as="script"><link rel="preload" href="/assets/js/2.bd61a9fd.js" as="script"><link rel="preload" href="/assets/js/68.f8b420bc.js" as="script"><link rel="prefetch" href="/assets/js/10.c23beeee.js"><link rel="prefetch" href="/assets/js/11.a5f8f4b5.js"><link rel="prefetch" href="/assets/js/12.3d44f3b2.js"><link rel="prefetch" href="/assets/js/13.85e66995.js"><link rel="prefetch" href="/assets/js/14.c61deefc.js"><link rel="prefetch" href="/assets/js/15.d567712f.js"><link rel="prefetch" href="/assets/js/16.0bf83400.js"><link rel="prefetch" href="/assets/js/17.39f15163.js"><link rel="prefetch" href="/assets/js/18.e190cbd6.js"><link rel="prefetch" href="/assets/js/19.b00f5399.js"><link rel="prefetch" href="/assets/js/20.24139e2e.js"><link rel="prefetch" href="/assets/js/21.f057fb05.js"><link rel="prefetch" href="/assets/js/22.91c23498.js"><link rel="prefetch" href="/assets/js/23.7e4349d1.js"><link rel="prefetch" href="/assets/js/24.d6b5644e.js"><link rel="prefetch" href="/assets/js/25.652a598d.js"><link rel="prefetch" href="/assets/js/26.239a6015.js"><link rel="prefetch" href="/assets/js/27.264e242d.js"><link rel="prefetch" href="/assets/js/28.b8a526cb.js"><link rel="prefetch" href="/assets/js/29.015f761b.js"><link rel="prefetch" href="/assets/js/3.1fc8e7ad.js"><link rel="prefetch" href="/assets/js/30.0cec9f87.js"><link rel="prefetch" href="/assets/js/31.d44d1dfd.js"><link rel="prefetch" href="/assets/js/32.01db05fd.js"><link rel="prefetch" href="/assets/js/33.b6466c13.js"><link rel="prefetch" href="/assets/js/34.bfcf59c7.js"><link rel="prefetch" href="/assets/js/35.383304c9.js"><link rel="prefetch" href="/assets/js/36.1e6e18c6.js"><link rel="prefetch" href="/assets/js/37.14bf4a83.js"><link rel="prefetch" href="/assets/js/38.5e53f1ea.js"><link rel="prefetch" href="/assets/js/39.5bb4ec98.js"><link rel="prefetch" href="/assets/js/4.7a8bea82.js"><link rel="prefetch" href="/assets/js/40.6c608590.js"><link rel="prefetch" href="/assets/js/41.23bd194f.js"><link rel="prefetch" href="/assets/js/42.d5004363.js"><link rel="prefetch" href="/assets/js/43.0ce9fa33.js"><link rel="prefetch" href="/assets/js/44.3fe716fe.js"><link rel="prefetch" href="/assets/js/45.32c5871d.js"><link rel="prefetch" href="/assets/js/46.b6783264.js"><link rel="prefetch" href="/assets/js/47.f8aab6d2.js"><link rel="prefetch" href="/assets/js/48.1f037f95.js"><link rel="prefetch" href="/assets/js/49.572445ce.js"><link rel="prefetch" href="/assets/js/5.9397a36a.js"><link rel="prefetch" href="/assets/js/50.7180282b.js"><link rel="prefetch" href="/assets/js/51.5e501b8b.js"><link rel="prefetch" href="/assets/js/52.f9837e49.js"><link rel="prefetch" href="/assets/js/53.d3df370a.js"><link rel="prefetch" href="/assets/js/54.6f904856.js"><link rel="prefetch" href="/assets/js/55.fc396f14.js"><link rel="prefetch" href="/assets/js/56.48304ea5.js"><link rel="prefetch" href="/assets/js/57.923bb766.js"><link rel="prefetch" href="/assets/js/58.5987358c.js"><link rel="prefetch" href="/assets/js/59.5c2eeb34.js"><link rel="prefetch" href="/assets/js/6.2f1db989.js"><link rel="prefetch" href="/assets/js/60.4ec959b6.js"><link rel="prefetch" href="/assets/js/61.52d60d03.js"><link rel="prefetch" href="/assets/js/62.f341f0fc.js"><link rel="prefetch" href="/assets/js/63.291774ef.js"><link rel="prefetch" href="/assets/js/64.3da1e937.js"><link rel="prefetch" href="/assets/js/65.44f41773.js"><link rel="prefetch" href="/assets/js/66.aea611c0.js"><link rel="prefetch" href="/assets/js/67.9432b5c4.js"><link rel="prefetch" href="/assets/js/69.bd196935.js"><link rel="prefetch" href="/assets/js/7.d3342e12.js"><link rel="prefetch" href="/assets/js/70.5f94436d.js"><link rel="prefetch" href="/assets/js/71.f8d75019.js"><link rel="prefetch" href="/assets/js/72.22a2029f.js"><link rel="prefetch" href="/assets/js/73.b5675a90.js"><link rel="prefetch" href="/assets/js/74.b9910b21.js"><link rel="prefetch" href="/assets/js/75.5aa44913.js"><link rel="prefetch" href="/assets/js/76.db5e59d0.js"><link rel="prefetch" href="/assets/js/77.e4edf460.js"><link rel="prefetch" href="/assets/js/78.adaa1ebd.js"><link rel="prefetch" href="/assets/js/79.c98afd34.js"><link rel="prefetch" href="/assets/js/8.f122493c.js"><link rel="prefetch" href="/assets/js/80.dae99de7.js"><link rel="prefetch" href="/assets/js/81.c8c4cc78.js"><link rel="prefetch" href="/assets/js/82.b8f7657a.js"><link rel="prefetch" href="/assets/js/83.708b497a.js"><link rel="prefetch" href="/assets/js/84.e5cf0bec.js"><link rel="prefetch" href="/assets/js/85.677ae3f9.js"><link rel="prefetch" href="/assets/js/86.b7a99301.js"><link rel="prefetch" href="/assets/js/87.4b8fd909.js"><link rel="prefetch" href="/assets/js/9.095bc7b5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c0e52d69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">山风笔记集</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/" class="nav-link router-link-active">笔记导航</a></li><li class="dropdown-item"><!----> <a href="/notes/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/notes/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/notes/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/notes/network/" class="nav-link router-link-active">网络</a></li><li class="dropdown-item"><!----> <a href="/notes/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/notes/tools/" class="nav-link">工具</a></li></ul></div></div><div class="nav-item"><a href="/pages/recent.html" class="nav-link">最近</a></div><div class="nav-item"><a href="/pages/msg-board.html" class="nav-link">留言</a></div><div class="nav-item"><a href="/pages/about.html" class="nav-link">关于</a></div><div class="nav-item"><a href="https://www.ceynri.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/ceynri" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/" class="nav-link router-link-active">笔记导航</a></li><li class="dropdown-item"><!----> <a href="/notes/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/notes/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/notes/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/notes/network/" class="nav-link router-link-active">网络</a></li><li class="dropdown-item"><!----> <a href="/notes/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/notes/tools/" class="nav-link">工具</a></li></ul></div></div><div class="nav-item"><a href="/pages/recent.html" class="nav-link">最近</a></div><div class="nav-item"><a href="/pages/msg-board.html" class="nav-link">留言</a></div><div class="nav-item"><a href="/pages/about.html" class="nav-link">关于</a></div><div class="nav-item"><a href="https://www.ceynri.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.github.com/ceynri" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/notes/network/" class="sidebar-link">浏览器与网络</a></li><li><a href="/notes/network/from-url-to-loaded.html" class="sidebar-link">从URL到页面加载完成</a></li><li><a href="/notes/network/cache.html" class="active sidebar-link">浏览器缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/network/cache.html#强缓存" class="sidebar-link">强缓存</a></li><li class="sidebar-sub-header"><a href="/notes/network/cache.html#协商缓存" class="sidebar-link">协商缓存</a></li></ul></li><li><a href="/notes/network/dns.html" class="sidebar-link">DNS 协议</a></li><li><a href="/notes/network/transport-layer-protocol.html" class="sidebar-link">传输层协议</a></li><li><a href="/notes/network/http.html" class="sidebar-link">HTTP 协议</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器缓存"><a href="#浏览器缓存" aria-hidden="true" class="header-anchor">#</a> 浏览器缓存</h1> <p>我们都知道，缓存的存在是为了节约通信成本、减少服务器负担、提高网页的响应速度，但也导致了资源文件过时的问题，所以这方面也有相应的策略，保证缓存的作用尽可能地得到发挥。</p> <p>浏览器缓存分为强缓存与协商缓存。简单而言，强缓存是没有过期的缓存，而协商缓存是过期了、但经过鉴定还能够继续使用的缓存。</p> <br> <h2 id="强缓存"><a href="#强缓存" aria-hidden="true" class="header-anchor">#</a> 强缓存</h2> <p>HTTP 响应报文的头中可以使用 <code>Expires</code> 与 <code>Cache-Control</code> 两个字段来标识资源的缓存时间：</p> <ul><li>Expires 属于 HTTP/1.0 的规范，使用绝对时间的 GMT 格式字符串表示缓存失效时间。</li> <li>Cache-Control 则来自 HTTP/1.1，使用 <code>max-age</code> 值或者特殊值来设置缓存策略。</li></ul> <p>Expires 最大的缺点就是因为其是一个绝对时间，当服务器与客户端的时间偏差较大时，会导致缓存变得混乱。</p> <br> <p>Cache-Control 则采用相对时间，解决了这个问题。例如：</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">Cache-Control:</span> max-age=3600
</code></pre></div><p>代表着资源的有效期是3600秒，接收到资源后的3600秒内无需重新访问服务器获取该资源，直接复用该缓存即可。</p> <p>除了设置 <code>max-age</code>，还有以下几个常用的设置值：</p> <ul><li>no-cache：不使用强缓存，但可以进行缓存协商。</li> <li>no-store：禁止游览器缓存数据，彻底不使用缓存。</li> <li>public：可以被所有的用户缓存，包括终端用户和 CDN 等中间代理服务器。</li> <li>private：只能被终端用户的浏览器缓存，不允许 CDN 等中继缓存服务器对其缓存。</li></ul> <p>为了兼容性，<code>Cache-Control</code> 与 <code>Expires</code> 可以在服务端配置同时启用，但同时启用的时候 <code>Cache-Control</code> 的优先级更高。</p> <br> <h2 id="协商缓存"><a href="#协商缓存" aria-hidden="true" class="header-anchor">#</a> 协商缓存</h2> <p>所谓协商，就是浏览器对于是否要使用该资源的缓存，都会先和服务器先进行沟通。</p> <p>在 HTTP/1.0 中，第一次响应返回的头中会带有 <code>Last-Modified</code> 字段，用来表示资源的最后一次修改日期。</p> <p>如在客户端的缓存过期后，客户端向服务端请求该文件时就会带上 <code>If-Modified-Since</code> 字段，其值为之前所收到的 <code>Last-Modified</code> 值。</p> <p>如果服务端将其与文件进行对比后发现没有修改，则只返回 304 响应码而不携带资源，说明该资源仍然能够继续使用，从而达到节约带宽的效果。</p> <p>但因为以下的原因，在 HTTP/1.1 中，这两个字段又有了新的版本：</p> <ul><li>有些文件会进行周期性的更改，但是他的内容并不改变，仅仅是改变了文件的最后修改时间</li> <li>如果文件的修改频率很高，1秒钟内修改了多次，那么原本的表示法无法精确到1秒以内</li> <li>某些服务器不能精确的得到文件的最后修改时间</li></ul> <p>于是对应地，出现了 <code>ETag</code> 与 <code>If-None-Match</code> 字段。</p> <br> <p><code>ETag</code> 是文件的唯一校验码，如果文件有进行修改，那么 <code>ETag</code> 就会发生变动。如果客户端发来的 <code>If-None-Match</code> 值与服务端文件的 <code>ETag</code> 比对不一致，则说明缓存已过期，需要重新发送文件。</p> <blockquote><p>HTTP 规范中并没有规定 <code>ETag</code> 应该用什么算法来生成，比较理想的是用哈希，但是因为这样非常消耗服务器资源，所以许多服务器一般是使用 <code>Last-Modified</code> + <code>Content-Length</code> 的十六进制表示连在一起来表示 <code>ETag</code>。</p></blockquote> <br> <p>某次请求得到的示例：</p> <p>部分请求头的字段：</p> <div class="language-http extra-class"><pre class="language-http"><code>:authority: ceynri.cn
:method: GET
<span class="token header-name keyword">cache-control:</span> max-age=0
<span class="token header-name keyword">if-modified-since:</span> Mon, 13 Apr 2020 06:23:12 GMT
<span class="token header-name keyword">if-none-match:</span> W/&quot;5e940550-3a60&quot;
</code></pre></div><p>部分响应头的字段：</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">date:</span> Tue, 14 Apr 2020 15:08:25 GMT
<span class="token header-name keyword">etag:</span> W/&quot;5e940550-3a60&quot;
<span class="token header-name keyword">last-modified:</span> Mon, 13 Apr 2020 06:23:12 GMT
<span class="token header-name keyword">status:</span> 304
</code></pre></div><blockquote><p>用户使用 <kbd>F5</kbd> 刷新页面时，会无视强缓存进行协商缓存的流程；如果使用 <kbd>Ctrl</kbd> + <kbd>F5</kbd> 强制刷新页面，则强制重新获取资源。</p></blockquote> <br></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2020-4-16 9:27:36 ├F10: PM┤</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/notes/network/from-url-to-loaded.html" class="prev">
          从URL到页面加载完成
        </a></span> <span class="next"><a href="/notes/network/dns.html">
          DNS 协议
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8447d795.js" defer></script><script src="/assets/js/2.bd61a9fd.js" defer></script><script src="/assets/js/68.f8b420bc.js" defer></script>
  </body>
</html>
